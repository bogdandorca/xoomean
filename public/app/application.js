angular.module("app",["ngRoute","ui.bootstrap","ngAnimate","uiGmapgoogle-maps"]).config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:"/partials/index/search",controller:"SearchCtrl"}).when("/list/:type/:destination/:checkIn/:checkOut",{templateUrl:"/partials/list/list",controller:"ListCtrl"}).when("/avail/:hotelId/:checkIn/:checkOut",{templateUrl:"/partials/avail/avail",controller:"AvailCtrl"}).when("/book/:hotelId/:checkIn/:checkOut/:rateKey/:roomTypeCode/:rateCode/:chargeableRate",{templateUrl:"partials/book/book",controller:"BookCtrl"}).when("/confirmation/:itineraryId/:email",{templateUrl:"partials/confirmation/confirmation",controller:"ConfirmationCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("app").controller("AvailCtrl",["$scope","$routeParams","$http","$location","ValueAdds","EanImage","$timeout",function($scope,$routeParams,$http,$location,ValueAdds,EanImage,$timeout){var hotelId=$routeParams.hotelId,checkIn=$routeParams.checkIn,checkOut=$routeParams.checkOut;$scope.rooms=[],$scope.hotelName="Hotel Details",$scope.checkInInstructions="",$scope.valueAdds=[],$scope.translate=function(imageUrl){return EanImage.translate(imageUrl,"b","t")},$scope.map={show:!1,refresh:function(){$scope.map.show=!1,$timeout(function(){$scope.map.show=!0})},center:{latitude:0,longitude:0},zoom:12,marker:{id:1,coords:{latitude:0,longitude:0},showWindow:!0},setCoordinates:function(lat,long){this.center.latitude=lat,this.center.longitude=long,this.marker.coords.latitude=lat,this.marker.coords.longitude=long}},$http.get("/api/avail/"+hotelId+"/"+checkIn+"/"+checkOut).success(function(data){data=data.HotelRoomAvailabilityResponse,$scope.hotelName=data.hotelName+", "+data.hotelCity+", "+data.hotelCountry,$scope.rooms=data.HotelRoomResponse,$scope.checkInInstructions=data.checkInInstructions}),$scope.hotelImages=[],$scope.selectedHotelImage="",$scope.changeHotelImage=function(imageIndex){$scope.selectedHotelImage=$scope.hotelImages[imageIndex].url},$http.get("/api/hotel/information/"+hotelId).success(function(data){data=data.HotelInformationResponse,$scope.hotelImages=data.HotelImages.HotelImage,$scope.selectedHotelImage=$scope.hotelImages[0].url,$scope.propertyDescription=data.HotelDetails.propertyDescription,$scope.map.setCoordinates(data.HotelSummary.latitude,data.HotelSummary.longitude)}),$scope.oneAtATime=!0,$scope.items=["Item 1","Item 2","Item 3"],$scope.addItem=function(){var newItemNo=$scope.items.length+1;$scope.items.push("Item "+newItemNo)},$scope.status={isFirstOpen:!0,isFirstDisabled:!1},$scope.valueAddIconGenerator=function(valueAdd){return ValueAdds.generateIcon(valueAdd)},$scope.selectRoom=function(room){var rateKey=room.RateInfos.RateInfo.RoomGroup.Room.rateKey,roomTypeCode=room.roomTypeCode,rateCode=room.rateCode,chargeableRate=encodeURIComponent(room.RateInfos.RateInfo.ChargeableRateInfo["@total"]);$location.path("/book/"+hotelId+"/"+checkIn+"/"+checkOut+"/"+rateKey+"/"+roomTypeCode+"/"+rateCode+"/"+chargeableRate)}}]),angular.module("app").controller("BookCtrl",["$scope","$http","$routeParams","$location",function($scope,$http,$routeParams,$location){var hotelId=$routeParams.hotelId,checkIn=$routeParams.checkIn,checkOut=$routeParams.checkOut,rateKey=$routeParams.rateKey,roomTypeCode=$routeParams.roomTypeCode,rateCode=$routeParams.rateCode,chargeableRate=encodeURIComponent($routeParams.chargeableRate);$scope.booking={firstName:"test",lastName:"booking",email:"bogdandorca@gmail.com",phone:"0040763191543",cardNumber:"5401999999999999",cardType:"CA",cardCvv:"123",cardMonth:"06",cardYear:"2017",cardFirstName:"Test",cardLastName:"Booking",address:"travelnow",city:"travelnow",province:"",country:"RO",postalCode:"515400"},$scope.book=function(booking){$http.post("/api/book/"+hotelId+"/"+checkIn+"/"+checkOut+"/"+rateKey+"/"+roomTypeCode+"/"+rateCode+"/"+chargeableRate,{data:{firstName:$scope.booking.firstName,lastName:$scope.booking.lastName,email:$scope.booking.email,phone:$scope.booking.phone,cardNumber:$scope.booking.cardNumber,cardType:$scope.booking.cardType,cardCvv:$scope.booking.cardCvv,cardMonth:$scope.booking.cardMonth,cardYear:$scope.booking.cardYear,cardFirstName:$scope.booking.cardFirstName,cardLastName:$scope.booking.cardLastName,address:$scope.booking.address,city:$scope.booking.city,province:$scope.booking.province,country:$scope.booking.country,postalCode:$scope.booking.postalCode}}).success(function(data){data=data.HotelRoomReservationResponse;var itineraryId=data.itineraryId;$location.path("/confirmation/"+itineraryId+"/"+$scope.booking.email)}).error(function(err){})}}]),angular.module("app").controller("ConfirmationCtrl",["$scope","$http","$routeParams",function($scope,$http,$routeParams){var itineraryId=$routeParams.itineraryId,email=$routeParams.email;$scope.heading=itineraryId,$http.get("/api/itinerary/"+itineraryId+"/"+email).success(function(data){data=data.HotelItineraryResponse,$scope.heading=data.Itinerary.itineraryId}).error(function(err){})}]),angular.module("app").controller("ListCtrl",["$scope","$http","$routeParams","$location","HotelList","EanImage",function($scope,$http,$routeParams,$location,HotelList,EanImage){$scope.hotelList=[],$scope.title="Select your favorite hotel",$scope.translate=function(imageUrl){return EanImage.translate(imageUrl,"t","l")};var type=$routeParams.type,destinationId=$routeParams.destination,checkIn=$routeParams.checkIn,checkOut=$routeParams.checkOut;HotelList.getHotelList(type,destinationId,checkIn,checkOut).then(function(data){"hotel"===type&&$scope.hotelSelect(data.HotelList.HotelSummary.hotelId),data.HotelList.HotelSummary.constructor===Array?$scope.hotelList=data.HotelList.HotelSummary:$scope.hotelList.push(data.HotelList.HotelSummary)}),HotelList.getDestinationDetails(destinationId).then(function(data){$scope.title=data.Name}),$scope.hotelSelect=function(hotelId){$location.path("/avail/"+hotelId+"/"+checkIn+"/"+checkOut)}}]),angular.module("app").controller("SearchCtrl",["$scope","$location","PopularDestinations","DatePicker","Toastr",function($scope,$location,PopularDestinations,DatePicker,Toastr){$scope.cidt=DatePicker.newDate(1,0,0,"dd/mm/yyyy"),$scope.checkInMinDate=$scope.checkInMinDate?null:new Date(DatePicker.newDate(1,0,0,"mm/dd/yyyy")),$scope.checkInMaxDate=new Date(DatePicker.newDate(1,3,0,"mm/dd/yyyy")),$scope.codt=DatePicker.newDate(3,0,0,"dd/mm/yyyy"),$scope.checkOutMinDate=$scope.checkOutMinDate?null:new Date(DatePicker.newDate(3,0,0,"mm/dd/yyyy")),$scope.checkOutMaxDate=new Date(DatePicker.newDate(2,3,0,"mm/dd/yyyy")),$scope.checkInOpened=!1,$scope.checkOutOpened=!1,$scope.datepickerOpen=function($event,panel){$event.preventDefault(),$event.stopPropagation(),$scope.checkInOpened="checkIn"===panel,$scope.checkOutOpened="checkOut"===panel},$scope.dateOptions=DatePicker.dateOptions,$scope.format=DatePicker.format,$scope.popularDestinations=[],$scope.popularDestinationsLoader=!0,$scope.defaultCheckIn=DatePicker.newDate(2,0,0,"dd-mm-yyyy"),$scope.defaultCheckOut=DatePicker.newDate(5,0,0,"dd-mm-yyyy"),PopularDestinations.getPopularDestinations().then(function(data){$scope.popularDestinations=data,$scope.popularDestinationsLoader=!1}),$scope.searchHotels=function(destination,checkIn,checkOut){destination&&destination.Type&&destination.DestinationId?checkIn&&checkOut?(toastr.clear(),$location.path("/list/"+destination.Type+"/"+destination.DestinationId+"/"+DatePicker.replaceDateSeparator(checkIn)+"/"+DatePicker.replaceDateSeparator(checkOut))):Toastr.errorToast("The dates selected are incorrect."):Toastr.errorToast("The destination entered is incorrect.")}}]),angular.module("app").filter("unsafe",["$sce",function($sce){return $sce.trustAsHtml}]),angular.module("app").directive("ngStarRating",[function(){var linker=function(scope,element,attr){scope.numberOfStars=attr.stars},getTemplate=function(){var templateStructure='<div class="stars">';return templateStructure+='<span ng-show="(numberOfStars >= 1) || numberOfStars == 0.5"><i class="fa" ng-class="numberOfStars == 0.5 ? \'fa-star-half\' : \'fa-star\'"></i></span>',templateStructure+='<span ng-show="(numberOfStars >= 2) || numberOfStars == 1.5"><i class="fa" ng-class="numberOfStars == 1.5 ? \'fa-star-half\' : \'fa-star\'"></i></span>',templateStructure+='<span ng-show="(numberOfStars >= 3) || numberOfStars == 2.5"><i class="fa" ng-class="numberOfStars == 2.5 ? \'fa-star-half\' : \'fa-star\'"></i></span>',templateStructure+='<span ng-show="(numberOfStars >= 4) || numberOfStars == 3.5"><i class="fa" ng-class="numberOfStars == 3.5 ? \'fa-star-half\' : \'fa-star\'"></i></span>',templateStructure+='<span ng-show="(numberOfStars >= 5) || numberOfStars == 4.5"><i class="fa" ng-class="numberOfStars == 4.5 ? \'fa-star-half\' : \'fa-star\'"></i></span>',templateStructure+="</div>"};return{restrict:"E",template:getTemplate(),link:linker}}]),angular.module("app").factory("DatePicker",[function(){return{formatDate:function(day,month,year,format){return"dd/mm/yyyy"===format?day.toString().dmFormat()+"/"+month.toString().dmFormat()+"/"+year:"mm/dd/yyyy"===format?month.toString().dmFormat()+"/"+day.toString().dmFormat()+"/"+year:"yyyy/mm/dd"===format?year+"/"+month.toString().dmFormat()+"/"+day.toString().dmFormat():"dd-mm-yyyy"===format?day.toString().dmFormat()+"-"+month.toString().dmFormat()+"-"+year:""},newDate:function(dayDelay,monthDelay,yearDelay,format){var date=new Date;date.setDate(date.getDate()+dayDelay);var day=date.getDate().toString().dmFormat(),month=(date.getMonth()+1+monthDelay).toString().dmFormat(),year=date.getFullYear()+yearDelay;return this.formatDate(day,month,year,format)},replaceDateSeparator:function(oldDate){return oldDate.replace("/","-").replace("/","-")},dateOptions:{formatYear:"yy",startingDay:1},formats:["dd/MM/yyyy","yyyy/MM/dd","dd/MM/yyyy","shortDate"],format:"dd/MM/yyyy"}}]),angular.module("app").factory("HotelList",["$http","$q",function($http,$q){return{getHotelList:function(type,destinationId,checkIn,checkOut){var defer=$q.defer();return $http.get("/api/list/"+type+"/"+destinationId+"/"+checkIn+"/"+checkOut+"/2").success(function(data){0!==data.length&&defer.resolve(data.HotelListResponse)}),defer.promise},getDestinationDetails:function(destinationId){var defer=$q.defer();return $http.get("/api/destination/details/"+destinationId).success(function(data){defer.resolve(data)}).error(function(){defer.resolve("Select your favorite hotel")}),defer.promise}}}]),angular.module("app").factory("EanImage",[function(){return{translate:function(image,from,to){return image.replace("_"+from+".jpg","_"+to+".jpg")}}}]),angular.module("app").factory("PopularDestinations",["$http","$q",function($http,$q){return{getPopularDestinations:function(){var deferred=$q.defer();return $http.get("/api/popular/7").success(function(data){deferred.resolve(data)}),deferred.promise},indentSelection:function(destinationId){$http.post("/api/popular/"+destinationId,{})}}}]),angular.module("app").factory("Toastr",[function(){return{successToast:function(message){toastr.options.closeButton=!0,toastr.options.preventDuplicates=!0,toastr.success(message)},errorToast:function(message){toastr.options.closeButton=!0,toastr.options.preventDuplicates=!0,toastr.error(message)}}}]),angular.module("app").factory("ValueAdds",[function(){return{generateIcon:function(valueAdd){return void 0!==valueAdd?valueAdd.indexOf("Breakfast")>-1?'<i class="fa fa-cutlery"></i> '+valueAdd:valueAdd.indexOf("Wireless")>-1||valueAdd.indexOf("Internet")>-1?'<i class="fa fa-wifi"></i> '+valueAdd:valueAdd.indexOf("Parking")>-1?'<i class="fa fa-car"></i> '+valueAdd:'<i class="fa fa-money"></i> '+valueAdd:void 0}}}]),angular.module("app").directive("ngAutocomplete",["$document","$http","PopularDestinations",function($document,$http,PopularDestinations){var linker=function(scope,element){$document.click(function(){scope.$apply(scope.hideAutocomplete=!0)}),element.click(function(event){event.stopPropagation()})},controller=function($scope){$scope.autocompleteList={cities:[],hotels:[],airports:[]};var resetAutocomplete=function(){$scope.autocompleteList={cities:[],hotels:[],airports:[]}};$scope.autocomplete=function(destination){destination.length>2?$http.get("/api/autocomplete/"+destination).success(function(data){resetAutocomplete();for(var i=0;i<data.length;i++)"city"===data[i].Type?$scope.autocompleteList.cities.push(data[i]):"hotel"===data[i].Type?$scope.autocompleteList.hotels.push(data[i]):"airport"===data[i].Type&&$scope.autocompleteList.airports.push(data[i]),$scope.hideAutocomplete=!1}):(resetAutocomplete(),$scope.hideAutocomplete=!0)},$scope.citiesArrayIsEmpty=function(){return 0===$scope.autocompleteList.cities.length},$scope.hotelsArrayIsEmpty=function(){return 0===$scope.autocompleteList.hotels.length},$scope.airportsArrayIsEmpty=function(){return 0===$scope.autocompleteList.airports.length},$scope.hideAutocomplete=!0;var autocompleteListIsEmpty=function(){return 0===$scope.autocompleteList.cities.length&&0===$scope.autocompleteList.hotels.length&&0===$scope.autocompleteList.airports.length};$scope.autocompleteIsHidden=function(){return autocompleteListIsEmpty()||$scope.hideAutocomplete},$scope.selectDestination=function(item,type){$scope.destination=item.Name,$scope.selectedDestination=item,PopularDestinations.indentSelection(item.DestinationId),resetAutocomplete()}};return{restrict:"A",link:linker,controller:controller,templateUrl:"./partials/index/autocomplete"}}]),String.prototype.dmFormat=function(){return 1===this.length?"0"+this:this};